;(function(){var q=function(){this._state=c.PENDING;this._value=[];this._callbacks={done:[],fail:[]}},c={PENDING:0,RESOLVED:1,REJECTED:2},b=q.prototype;b.always=function(){this.then.apply(this,arguments);return this};b.done=function(a,f){var g=this._state;g===c.PENDING?this._callbacks.done.push({fn:a,ctx:f}):g===c.RESOLVED&&a.apply(f,this._value);return this};b.fail=function(a,f){var g=this._state;g===c.PENDING?this._callbacks.fail.push({fn:a,ctx:f}):g===c.REJECTED&&a.apply(f,this._value);return this};
  b.isPending=function(){return this._state===c.PENDING};b.isRejected=function(){return this._state===c.REJECTED};b.isResolved=function(){return this._state===c.RESOLVED};b.then=function(a,f,g){var b=arguments[arguments.length-1],d=new e;b&&"function"!==typeof b&&(g=b);"function"===typeof a?this.done(function(){var f,b;try{f=a.apply(g,arguments)}catch(c){b=c}void 0!==b?d.reject(b):void 0!==f&&d.resolve(f)}):this._state===c.RESOLVED&&d.resolve.apply(d,this._value);"function"===typeof f?this.fail(function(){var a,
    b;try{a=f.apply(g,arguments)}catch(c){b=c}void 0!==b?d.reject(b):void 0!==a&&d.resolve(a)}):this._state===c.REJECTED&&d.reject.apply(d,this._value);return d.promise};var e=function(){this.promise=new q},b=e.prototype;b.reject=function(){var a=this.promise;if(a._state!==c.PENDING)return this;a._state=c.REJECTED;a._value=arguments;for(var f=a._callbacks.fail,b,e=0,d=f.length;e<d;e++)b=f[e],b.fn.apply(b.ctx,a._value);return this};b.resolve=function(a){var b=this.promise,g=c.PENDING,t=c.RESOLVED,d,k,
    l,h,m,u=this;if(b._state!==c.PENDING)return this;if(a===this||a===b)return k=new TypeError("Promise and argument refer to the same object"),this.reject(k),this;var n=a instanceof e,r=a instanceof q,s=n||r,p=typeof a;if(null!==a&&("object"===p||"function"===p))try{var v=a.then}catch(w){return this.reject(w),this}p="function"===typeof v;r=r?a._state===g:n?a.promise._state===g:!1;!p||s&&!r||(k=function(){if(b._state!==g)return!1;s&&(d=n?a.promise._value:a._value);b._state=t;b._value=d||Array.prototype.slice.call(arguments);
    var c,e=b._callbacks.done;h=0;for(m=e.length;h<m;h++)c=e[h],c.fn.apply(c.ctx,b._value);return!0},l=function(){if(b._state!==g)return!1;s&&(d=n?a.promise._value:a._value);u.reject.apply(u,d||arguments);return!0});if(s){d=n?a.promise._value:a._value;if(a.isRejected())return this.reject.apply(this,d),this;if(a.isResolved()){b._state=t;b._value=d;l=b._callbacks.done;h=0;for(m=l.length;h<m;h++)k=l[h],k.fn.apply(k.ctx,b._value);return this}try{a.then(k,l)}catch(x){this.isPending()&&this.reject(x)}return this}if(p){try{a.then(k,
    l)}catch(y){this.isPending()&&this.reject(y)}return this}b._state=t;b._value=arguments;l=b._callbacks.done;h=0;for(m=l.length;h<m;h++)k=l[h],k.fn.apply(k.ctx,b._value);return this};b.done=function(){var a=this.promise;a.done.apply(a,arguments);return this};b.fail=function(){var a=this.promise;a.fail.apply(a,arguments);return this};b.isPending=function(){return this.promise._state===c.PENDING};b.isRejected=function(){return this.promise._state===c.REJECTED};b.isResolved=function(){return this.promise._state===
    c.RESOLVED};b.then=function(){var a=this.promise;return a.then.apply(a,arguments)};e.isPromise=function(a){return a instanceof q||a instanceof e};e.isDeferred=function(a){return a instanceof e};e.when=function(){};window.Deferred=e})();
