/*!
 * Deferred - v0.1.0
 * 2014-10-10
 */
!function(a){"use strict";var b=function(){this.value=void 0,this._state=0};b.prototype.always=function(a,b){return a instanceof c?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,b).fail(a,b),this},b.prototype.done=function(b,d){var e=this._state,f=b instanceof c;return d=d!==a?d:this,1===e?(f?b.resolve.call(b,this.value):b.call(d,this.value),this):(0===e&&(f?this.done(function(a){b.resolve.call(b,a)}):(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:b,ctx:d}))),this)},b.prototype.fail=function(b,d){var e=this._state,f=b instanceof c;return d=d!==a?d:this,2===e?(f?b.reject.call(b,this.value):b.call(d,this.value),this):(0===e&&(f?this.fail(function(a){b.reject(a)}):(this.hasOwnProperty("_failCallbacks")||(this._failCallbacks=[]),this._failCallbacks.push({fn:b,ctx:d}))),this)},b.prototype.isPending=function(){return 0===this._state},b.prototype.isRejected=function(){return 2===this._state},b.prototype.isResolved=function(){return 1===this._state},b.prototype.then=function(b,d,e){var f,g=arguments[arguments.length-1],h=new c,i="function";return f=typeof g!==i?g:e,f=f!==a?f:this,typeof b===i?this.done(function(c){var d,e;try{d=b.call(f,c)}catch(g){e=g}e!==a?h.reject(e):d!==a&&h.resolve(d)}):1===this._state&&h.resolve(this.value),typeof d===i?this.fail(function(b){var c,e;try{c=d.call(f,b)}catch(g){e=g}e!==a?h.reject(e):c!==a&&h.resolve(c)}):2===this._state&&h.reject(this.value),h.promise};var c=function(){this.promise=new b};c.prototype.reject=function(a){var b=this.promise;if(0!==b._state)return this;b._state=2,b.value=a;for(var c,d=b._failCallbacks,e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,b.value);return this},c.prototype.resolve=function(a){var c,d,e,f,g,h=this.promise;if(0!==h._state)return this;var i,j="function",k=this;if(a===this||a===h){var l=new TypeError("Promise and argument refer to the same object");return this.reject(l),this}var m=a instanceof b,n=typeof a;if(null!==a&&("object"===n||n===j))try{i=a.then}catch(l){return this.reject(l),this}var o,p,q,r=typeof i===j;if(o=m?0===a._state:!1,!r||m&&!o||(p=function(b){if(0!==h._state)return!1;m&&(c=a.value),h._state=1,h.value=c||b;var d,e=h._doneCallbacks;if(e)for(f=0,g=e.length;g>f;f++)d=e[f],d.fn.call(d.ctx,h.value);return!0},q=function(b){return 0!==h._state?!1:(m&&(c=a.value),k.reject(c||b),!0)}),m){var s=a._state;if(2===s)return this.reject(a.value),this;if(1===s){if(h._state=1,h.value=a.value,e=h._doneCallbacks)for(f=0,g=e.length;g>f;f++)d=e[f],d.fn.call(d.ctx,h.value);return this}try{a.then(p,q)}catch(l){0===this.promise._state&&this.reject(l)}return p=null,q=null,this}if(r){try{a.then(p,q)}catch(l){0===this.promise._state&&this.reject(l)}return p=null,q=null,this}if(h._state=1,h.value=a,e=h._doneCallbacks)for(f=0,g=e.length;g>f;f++)d=e[f],d.fn.call(d.ctx,h.value);return this},c.isPromise=function(a){return a instanceof b||a instanceof c},c.isDeferred=function(a){return a instanceof c},c.all=function(a){var b,d,e=new c,f=a.length,g=[],h=[];g.length=a.length;for(var i=function(a){var b=h.indexOf(this.uid);g[b]=a,f-=1,0===f&&e.resolve(g)},j=function(a){var b=h.indexOf(this.uid);g[b]=a,e.reject(g)},k=0,l=a.length;l>k;k++){if(b=a[k],b instanceof c&&(b=b.promise),h.push(b.uid),2===b._state)return d=h.indexOf(b.uid),g[d]=b.value,e.reject(g).promise;b.done(i).fail(j)}return e.promise},c.any=function(a){var b,d,e=new c,f=a.length,g=[],h=[];g.length=a.length;for(var i=function(a){var b=h.indexOf(this.uid);g[b]=a,e.resolve(g)},j=function(a){var b=h.indexOf(this.uid);g[b]=a,f-=1,0===f&&e.reject(g)},k=0,l=a.length;l>k;k++){if(b=a[k],b instanceof c&&(b=b.promise),h.push(b.uid),1===b._state)return d=h.indexOf(b.uid),g[d]=b.value,e.resolve(g).promise;b.done(i).fail(j)}return e.promise},"object"==typeof module&&"object"==typeof module.exports?module.exports=c:"function"==typeof define&&define.amd?define("Deferred",[],function(){return c}):"object"==typeof window&&(window.Deferred=c)}();