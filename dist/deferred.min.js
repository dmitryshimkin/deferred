/*!
 * Deferred - v0.1.0
 * 2014-07-25
 */
!function(a){"use strict";var b=function(){this.value=void 0,this._state=0,this._doneCallbacks=[],this._failCallbacks=[]};b.prototype.always=function(a,b){return a instanceof d?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,b).fail(a,b),this},b.prototype.done=function(b,c){var e=this._state,f=b instanceof d;return c=c!==a?c:this,1===e?(f?b.resolve.call(b,this.value):b.call(c,this.value),this):(0===e&&(f?this.done(function(a){b.resolve.call(b,a)}):this._doneCallbacks.push({fn:b,ctx:c})),this)},b.prototype.fail=function(b,c){var e=this._state,f=b instanceof d;return c=c!==a?c:this,2===e?(f?b.reject.call(b,this.value):b.call(c,this.value),this):(0===e&&(f?this.fail(function(a){b.reject(a)}):this._failCallbacks.push({fn:b,ctx:c})),this)},b.prototype.isPending=function(){return 0===this._state},b.prototype.isRejected=function(){return 2===this._state},b.prototype.isResolved=function(){return 1===this._state},b.prototype.then=function(b,c,e){var f,g=arguments[arguments.length-1],h=new d,i="function";return f=typeof g!==i?g:e,f=f!==a?f:this,typeof b===i?this.done(function(c){var d,e;try{d=b.call(f,c)}catch(g){e=g}e!==a?h.reject(e):d!==a&&h.resolve(d)}):1===this._state&&h.resolve(this.value),typeof c===i?this.fail(function(b){var d,e;try{d=c.call(f,b)}catch(g){e=g}e!==a?h.reject(e):d!==a&&h.resolve(d)}):2===this._state&&h.reject(this.value),h.promise};var c=0,d=function(){this.uid=c++,this.promise=new b,this.promise.uid=this.uid};d.prototype.reject=function(a){var b=this.promise;if(0!==b._state)return this;b._state=2,b.value=a;for(var c,d=b._failCallbacks,e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,b.value);return this},d.prototype.resolve=function(a){var c,e,f,g,h,i=this.promise;if(0!==i._state)return this;var j,k="function",l=this;if(a===this||a===i){var m=new TypeError("Promise and argument refer to the same object");return this.reject(m),this}var n=a instanceof d,o=a instanceof b,p=n||o,q=typeof a;if(null!==a&&("object"===q||q===k))try{j=n?a.promise.then:a.then}catch(m){return this.reject(m),this}var r,s,t,u=typeof j===k;if(r=o?0===a._state:n?0===a.promise._state:!1,!u||p&&!r||(s=function(b){if(0!==i._state)return!1;p&&(c=n?a.promise.value:a.value),i._state=1,i.value=c||b;var d,e=i._doneCallbacks;for(g=0,h=e.length;h>g;g++)d=e[g],d.fn.call(d.ctx,i.value);return!0},t=function(b){return 0!==i._state?!1:(p&&(c=n?a.promise.value:a.value),l.reject(c||b),!0)}),p){c=n?a.promise.value:a.value;var v=n?a.promise._state:a._state;if(2===v)return this.reject(c),this;if(1===v){for(i._state=1,i.value=c,f=i._doneCallbacks,g=0,h=f.length;h>g;g++)e=f[g],e.fn.call(e.ctx,i.value);return this}try{n?a.promise.then(s,t):a.then(s,t)}catch(m){0===this.promise._state&&this.reject(m)}return s=null,t=null,this}if(u){try{n?a.promise.then(s,t):a.then(s,t)}catch(m){0===this.promise._state&&this.reject(m)}return s=null,t=null,this}for(i._state=1,i.value=a,f=i._doneCallbacks,g=0,h=f.length;h>g;g++)e=f[g],e.fn.call(e.ctx,i.value);return this},d.isPromise=function(a){return a instanceof b||a instanceof d},d.isDeferred=function(a){return a instanceof d},d.all=function(a){var b,c,e=new d,f=a.length,g=[],h=[];g.length=a.length;for(var i=function(a){var b=h.indexOf(this.uid);g[b]=a,f-=1,0===f&&e.resolve(g)},j=function(a){var b=h.indexOf(this.uid);g[b]=a,e.reject(g)},k=0,l=a.length;l>k;k++){if(b=a[k],b instanceof d&&(b=b.promise),h.push(b.uid),2===b._state)return c=h.indexOf(b.uid),g[c]=b.value,e.reject(g).promise;b.done(i).fail(j)}return e.promise},d.any=function(a){var b,c,e=new d,f=a.length,g=[],h=[];g.length=a.length;for(var i=function(a){var b=h.indexOf(this.uid);g[b]=a,e.resolve(g)},j=function(a){var b=h.indexOf(this.uid);g[b]=a,f-=1,0===f&&e.reject(g)},k=0,l=a.length;l>k;k++){if(b=a[k],b instanceof d&&(b=b.promise),h.push(b.uid),1===b._state)return c=h.indexOf(b.uid),g[c]=b.value,e.resolve(g).promise;b.done(i).fail(j)}return e.promise},"object"==typeof module&&"object"==typeof module.exports?module.exports=d:"function"==typeof define&&define.amd?define("Deferred",[],function(){return d}):"object"==typeof window&&(window.Deferred=d)}();