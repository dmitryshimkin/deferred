/*!
 * Deferred - v0.1.0
 * 2014-10-15
 */
!function(){"use strict";function a(a,b,c){a.hasOwnProperty(b)||(a[b]=[]),a[b].push(c)}function b(a){a[0]=null,a[1]=null}function c(a,b){var c;if(a)for(var d=0,e=a.length;e>d;d++)c=a[d],c.fn.call(c.ctx,b)}var d=function(){this.value=void 0,this._state=0};d.prototype.always=function(a,b){return a instanceof e?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,b).fail(a,b),this},d.prototype.done=function(b,c){var d=this._state,f=b instanceof e;return void 0===c&&(c=this),2===d?(f?b.resolve(this.value):b.call(c,this.value),this):(0===d&&(f?this.done(function(a){b.resolve.call(b,a)}):a(this,1,{fn:b,ctx:c})),this)},d.prototype.fail=function(b,c){var d=this._state,f=b instanceof e;return void 0===c&&(c=this),3===d?(f?b.reject(this.value):b.call(c,this.value),this):(0===d&&(f?this.fail(function(a){b.reject(a)}):a(this,0,{fn:b,ctx:c})),this)},d.prototype.isPending=function(){return this._state<=1},d.prototype.isRejected=function(){return 3===this._state},d.prototype.isResolved=function(){return 2===this._state},d.prototype.then=function(a,b,c){var d,f=arguments[arguments.length-1],g=2===this._state,h=3===this._state,i=new e,j="function";if(d=typeof f!==j?f:c,void 0===d&&(d=this),typeof a===j)this.done(function(b){var c,e;try{c=a.call(d,b)}catch(f){e=f}void 0!==e?i.reject(e):i.resolve(c)});else if(g)return i.resolve(this.value),i.promise;return typeof b===j?this.fail(function(a){var c,e;try{c=b.call(d,a)}catch(f){e=f}void 0!==e?i.reject(e):i.resolve(c)}):h&&i.reject(this.value),i.promise},d.prototype.error=function(a,b){var c=this;return this.fail(function(){c.value instanceof Error&&a.call(b,c.value)},b),this};var e=function(){this.promise=new d};e.prototype.reject=function(a){return 0!==this.promise._state?this:(this.promise._state=3,this.promise.value=a,c(this.promise[0],a),b(this.promise),this)},e.prototype.resolve=function(a){var e=this,f=this.promise;if(0!==f._state)return this;if(a===this||a===f){var g=new TypeError("Promise and argument refer to the same object");return this.reject(g),this}return a instanceof d?(f._state=1,a.done(function(a){f._state=0,e.resolve(a)}).fail(function(a){f._state=0,e.reject(a)}),this):(f._state=2,f.value=a,c(f[1],f.value),b(f),this)},e.isPromise=function(a){return a instanceof d},e.isDeferred=function(a){return a instanceof e},e.all=function(a){var b=new e;if(!a)return b.promise;var c,d,f=new Array(a.length),g=0;for(c=0,d=a.length;d>c;c++){if(a[c].isRejected())return b.reject(a[c].value),b.promise;a[c].isResolved()?f[c]=a[c].value:(g++,a[c].fail(function(a){b.reject(a)}),a[c].done(function(c){var d=e.all.indexOf(a,this);f[d]=c,g--,0===g&&b.resolve(f)},a[c]))}return g?b.promise:(b.resolve(f),b.promise)},e.all.indexOf=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1},e.race=function(a){var b=new e;if(!a)return b.promise;var c,d,f=new Array(a.length),g=0;for(c=0,d=a.length;d>c;c++){if(a[c].isResolved())return b.resolve(a[c].value),b.promise;a[c].isRejected()?f[c]=a[c].value:(g++,a[c].done(function(a){b.resolve(a)}),a[c].fail(function(c){var d=e.all.indexOf(a,this);f[d]=c,g--,0===g&&b.reject(f)},a[c]))}return g?b.promise:(b.reject(f),b.promise)},"object"==typeof module&&"object"==typeof module.exports?module.exports=e:"function"==typeof define&&define.amd?define("Deferred",[],function(){return e}):"object"==typeof window&&(window.Deferred=e)}();