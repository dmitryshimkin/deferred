/*!
 * Deferred - v0.1.0
 * 2014-10-15
 */
!function(){"use strict";function a(a,b){var c;if(a)for(var d=0,e=a.length;e>d;d++)c=a[d],c.fn.call(c.ctx,b)}var b=function(){this.value=void 0,this._state=0};b.prototype.always=function(a,b){return a instanceof c?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,b).fail(a,b),this},b.prototype.done=function(a,b){var d=this._state,e=a instanceof c;return void 0===b&&(b=this),2===d?(e?a.resolve(this.value):a.call(b,this.value),this):(0===d&&(e?this.done(function(b){a.resolve.call(a,b)}):(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:a,ctx:b}))),this)},b.prototype.fail=function(a,b){var d=this._state,e=a instanceof c;return void 0===b&&(b=this),3===d?(e?a.reject(this.value):a.call(b,this.value),this):(0===d&&(e?this.fail(function(b){a.reject(b)}):(this.hasOwnProperty("_failCallbacks")||(this._failCallbacks=[]),this._failCallbacks.push({fn:a,ctx:b}))),this)},b.prototype.isPending=function(){return this._state<=1},b.prototype.isRejected=function(){return 3===this._state},b.prototype.isResolved=function(){return 2===this._state},b.prototype.then=function(a,b,d){var e,f=arguments[arguments.length-1],g=2===this._state,h=3===this._state,i=new c,j="function";if(e=typeof f!==j?f:d,void 0===e&&(e=this),typeof a===j){var k=function(b){var c,d;try{c=a.call(e,b)}catch(f){d=f}void 0!==d?i.reject(d):i.resolve(c)};if(g)return k(this.value),i.promise;0===this._state&&(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:k,ctx:null}))}else if(g)return i.resolve(this.value),i.promise;if(typeof b===j){var l=function(a){var c,d;try{c=b.call(e,a)}catch(f){d=f}void 0!==d?i.reject(d):i.resolve(c)};this.fail(l)}else h&&i.reject(this.value);return i.promise},b.prototype.error=function(a,b){var c=this._state,d=this;if(void 0===b&&(b=d),2===c)return d;if(3===c)return d.value instanceof Error&&a.call(b,this.value),this;d.hasOwnProperty("_failCallbacks")||(d._failCallbacks=[]);var e=function(){d.value instanceof Error&&a.call(b,d.value)};return d._failCallbacks.push({fn:e,ctx:b}),this};var c=function(){this.promise=new b};c.prototype.reject=function(a){var b=this.promise;if(0!==b._state)return this;b._state=3,b.value=a;var c,d=b._failCallbacks;if(d)for(var e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,b.value);return b._doneCallbacks=null,b._failCallbacks=null,this},c.prototype.resolve=function(c){var d=this,e=this.promise;if(0!==e._state)return this;if(c===this||c===e){var f=new TypeError("Promise and argument refer to the same object");return this.reject(f),this}return c instanceof b?(e._state=1,c.done(function(a){e._state=0,d.resolve(a)}).fail(function(a){e._state=0,d.reject(a)}),this):(e._state=2,e.value=c,a(e._doneCallbacks,e.value),e._doneCallbacks=null,e._failCallbacks=null,this)},c.isPromise=function(a){return a instanceof b},c.isDeferred=function(a){return a instanceof c},c.all=function(a){var b=new c;if(!a)return b.promise;var d,e,f=new Array(a.length),g=0;for(d=0,e=a.length;e>d;d++){if(a[d].isRejected())return b.reject(a[d].value),b.promise;a[d].isResolved()?f[d]=a[d].value:(g++,a[d].fail(function(a){b.reject(a)}),a[d].done(function(d){var e=c.all.indexOf(a,this);f[e]=d,g--,0===g&&b.resolve(f)},a[d]))}return g?b.promise:(b.resolve(f),b.promise)},c.all.indexOf=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1},c.race=function(a){var b=new c;if(!a)return b.promise;var d,e,f=new Array(a.length),g=0;for(d=0,e=a.length;e>d;d++){if(a[d].isResolved())return b.resolve(a[d].value),b.promise;a[d].isRejected()?f[d]=a[d].value:(g++,a[d].done(function(a){b.resolve(a)}),a[d].fail(function(d){var e=c.all.indexOf(a,this);f[e]=d,g--,0===g&&b.reject(f)},a[d]))}return g?b.promise:(b.reject(f),b.promise)},"object"==typeof module&&"object"==typeof module.exports?module.exports=c:"function"==typeof define&&define.amd?define("Deferred",[],function(){return c}):"object"==typeof window&&(window.Deferred=c)}();