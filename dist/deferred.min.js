/*!
 * Deferred - v0.1.0
 * 2014-10-11
 */
!function(a){"use strict";var b=function(){this.value=void 0,this._state=0};b.prototype.always=function(a,b){return a instanceof c?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,b).fail(a,b),this},b.prototype.done=function(b,d){var e=this._state,f=b instanceof c;return d=d!==a?d:this,1===e?(f?b.resolve(this.value):b.call(d,this.value),this):(0===e&&(f?this.done(function(a){b.resolve.call(b,a)}):(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:b,ctx:d}))),this)},b.prototype.fail=function(b,d){var e=this._state,f=b instanceof c;return d=d!==a?d:this,2===e?(f?b.reject(this.value):b.call(d,this.value),this):(0===e&&(f?this.fail(function(a){b.reject(a)}):(this.hasOwnProperty("_failCallbacks")||(this._failCallbacks=[]),this._failCallbacks.push({fn:b,ctx:d}))),this)},b.prototype.isPending=function(){return 0===this._state},b.prototype.isRejected=function(){return 2===this._state},b.prototype.isResolved=function(){return 1===this._state},b.prototype.then=function(a,b,d){var e,f=arguments[arguments.length-1],g=1===this._state,h=2===this._state,i=new c,j="function";if(e=typeof f!==j?f:d,void 0===e&&(e=this),typeof a===j){if(g)return i.promise;0===this._state}else if(g)return i.resolve(this.value),i.promise;if(typeof b===j){var k=function(a){var c,d;try{c=b.call(e,a)}catch(f){d=f}void 0!==d?i.reject(d):i.resolve(c)};this.fail(k)}else h&&i.reject(this.value);return i.promise};var c=function(){this.promise=new b};c.prototype.reject=function(a){var b=this.promise;if(0!==b._state)return this;b._state=2,b.value=a;var c,d=b._failCallbacks;if(d)for(var e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,b.value);return this},c.prototype.resolve=function(a){var c,d,e,f,g=this.promise;if(0!==g._state)return this;if(a===this||a===g){var h=new TypeError("Promise and argument refer to the same object");return this.reject(h),this}var i=a instanceof b;if(i){var j=a._state;if(2===j)return this.reject(a.value),this;if(1===j){if(g._state=1,g.value=a.value,d=g._doneCallbacks)for(e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,g.value);return this}var k=function(a){if(0!==g._state)return!1;g._state=1,g.value=a;var b=g._doneCallbacks;if(b){var c;for(e=0,f=b.length;f>e;e++)c=b[e],c.fn.call(c.ctx,g.value)}return!0},l=function(a){if(0!==g._state)return!1;g._state=2,g.value=a;var b=g._failCallbacks;if(b)for(var c,d=0,e=b.length;e>d;d++)c=b[d],c.fn.call(c.ctx,g.value);return!0};try{a.done(k).fail(l)}catch(h){0===this.promise._state&&this.reject(h)}return k=null,l=null,this}if(g._state=1,g.value=a,d=g._doneCallbacks)for(e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,g.value);return this},c.isPromise=function(a){return a instanceof b||a instanceof c},c.isDeferred=function(a){return a instanceof c},"object"==typeof module&&"object"==typeof module.exports?module.exports=c:"function"==typeof define&&define.amd?define("Deferred",[],function(){return c}):"object"==typeof window&&(window.Deferred=c)}();