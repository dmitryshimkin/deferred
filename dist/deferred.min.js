/*!
 * Deferred - v0.1.0
 * 2014-10-14
 */
!function(){"use strict";var a=function(){this.value=void 0,this._state=0};a.prototype.always=function(a,c){return a instanceof b?this.done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):this.done(a,c).fail(a,c),this},a.prototype.done=function(a,c){var d=this._state,e=a instanceof b;return void 0===c&&(c=this),2===d?(e?a.resolve(this.value):a.call(c,this.value),this):(0===d&&(e?this.done(function(b){a.resolve.call(a,b)}):(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:a,ctx:c}))),this)},a.prototype.fail=function(a,c){var d=this._state,e=a instanceof b;return void 0===c&&(c=this),3===d?(e?a.reject(this.value):a.call(c,this.value),this):(0===d&&(e?this.fail(function(b){a.reject(b)}):(this.hasOwnProperty("_failCallbacks")||(this._failCallbacks=[]),this._failCallbacks.push({fn:a,ctx:c}))),this)},a.prototype.isPending=function(){return this._state<=1},a.prototype.isRejected=function(){return 3===this._state},a.prototype.isResolved=function(){return 2===this._state},a.prototype.then=function(a,c,d){var e,f=arguments[arguments.length-1],g=2===this._state,h=3===this._state,i=new b,j="function";if(e=typeof f!==j?f:d,void 0===e&&(e=this),typeof a===j){var k=function(b){var c,d;try{c=a.call(e,b)}catch(f){d=f}void 0!==d?i.reject(d):i.resolve(c)};if(g)return k(this.value),i.promise;0===this._state&&(this.hasOwnProperty("_doneCallbacks")||(this._doneCallbacks=[]),this._doneCallbacks.push({fn:k,ctx:null}))}else if(g)return i.resolve(this.value),i.promise;if(typeof c===j){var l=function(a){var b,d;try{b=c.call(e,a)}catch(f){d=f}void 0!==d?i.reject(d):i.resolve(b)};this.fail(l)}else h&&i.reject(this.value);return i.promise},a.prototype.error=function(a,b){var c=this._state,d=this;if(void 0===b&&(b=d),2===c)return d;if(3===c)return d.value instanceof Error&&a.call(b,this.value),this;d.hasOwnProperty("_failCallbacks")||(d._failCallbacks=[]);var e=function(){d.value instanceof Error&&a.call(b,d.value)};return d._failCallbacks.push({fn:e,ctx:b}),this};var b=function(){this.promise=new a};b.prototype.reject=function(a){var b=this.promise;if(0!==b._state)return this;b._state=3,b.value=a;var c,d=b._failCallbacks;if(d)for(var e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,b.value);return b._doneCallbacks=null,b._failCallbacks=null,this},b.prototype.resolve=function(b){var c,d,e,f,g=this.promise;if(0!==g._state)return this;if(b===this||b===g){var h=new TypeError("Promise and argument refer to the same object");return this.reject(h),this}if(b instanceof a){var i=b._state;if(i>1){for(g._state=i,g.value=b.value,d=2===i?g._doneCallbacks:g._failCallbacks,e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,g.value);return g._doneCallbacks=null,g._failCallbacks=null,this}var j=function(a){g._state=2,g.value=a;var b=g._doneCallbacks;if(b){var c;for(e=0,f=b.length;f>e;e++)c=b[e],c.fn.call(c.ctx,g.value)}return g._doneCallbacks=null,g._failCallbacks=null,!0},k=function(a){g._state=3,g.value=a;var b=g._failCallbacks;if(b)for(var c,d=0,e=b.length;e>d;d++)c=b[d],c.fn.call(c.ctx,g.value);return g._doneCallbacks=null,g._failCallbacks=null,!0};return g._state=1,b.done(j).fail(k),j=null,k=null,this}if(g._state=2,g.value=b,d=g._doneCallbacks)for(e=0,f=d.length;f>e;e++)c=d[e],c.fn.call(c.ctx,g.value);return g._doneCallbacks=null,g._failCallbacks=null,this},b.isPromise=function(b){return b instanceof a},b.isDeferred=function(a){return a instanceof b},b.all=function(a){var c=new b;if(!a)return c.promise;var d,e,f=new Array(a.length),g=0;for(d=0,e=a.length;e>d;d++){if(a[d].isRejected())return c.reject(a[d].value),c.promise;a[d].isResolved()?f[d]=a[d].value:(g++,a[d].fail(function(a){c.reject(a)}),a[d].done(function(d){var e=b.all.indexOf(a,this);f[e]=d,g--,0===g&&c.resolve(f)},a[d]))}return g?c.promise:(c.resolve(f),c.promise)},b.all.indexOf=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1},b.race=function(a){var c=new b;if(!a)return c.promise;var d,e,f=new Array(a.length),g=0;for(d=0,e=a.length;e>d;d++){if(a[d].isResolved())return c.resolve(a[d].value),c.promise;a[d].isRejected()?f[d]=a[d].value:(g++,a[d].done(function(a){c.resolve(a)}),a[d].fail(function(d){var e=b.all.indexOf(a,this);f[e]=d,g--,0===g&&c.reject(f)},a[d]))}return g?c.promise:(c.reject(f),c.promise)},"object"==typeof module&&"object"==typeof module.exports?module.exports=b:"function"==typeof define&&define.amd?define("Deferred",[],function(){return b}):"object"==typeof window&&(window.Deferred=b)}();